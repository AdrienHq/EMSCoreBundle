{% extends '@EMSCore/base.html.twig' %}{% trans_default_domain 'EMSCoreBundle' %}

{% block title %}Recursive view of the {{ object._type }} : {{ object._id }}{% endblock %}
{% block pagetitle %}
    <i class="{% if contentType and contentType.icon %}{{ contentType.icon }} {% else %} fa fa-question {% endif %} "></i>
    {{ object._type|humanize }} :

    {% if contentType and (contentType.labelField) and (attribute(attribute(object, '_source'), contentType.labelField)  is defined ) %}
        {{ attribute(attribute(object, '_source'), contentType.labelField) }}
        <small>{{ object._id }}</small>
    {% else %}
        {{ object._id }}
    {% endif %}


    as indexed in
    <span class="badge bg-{{ environment.color|raw }}">{{ environment.name|humanize }}</span>
{% endblock %} 

{% block subtitle %}{% endblock %} 

{% block body %}
    <div class="row raw-view">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Recursif view</h3>
                </div>
                <div class="box-body">
                    <pre class="ems-code-editor" data-language="ace/mode/json"
                         data-them="ace/theme/chrome">{{ object|json_encode(constant('JSON_PRETTY_PRINT')) }}</pre>
                </div>
                <!-- /.box-body -->
                <div class="box-footer">
                    {% include '@EMSCore/elements/object-toolbar.html.twig' with {
                        'object':  object,
                        'contentType': contentType,
                        'recursiveView': true
                    } %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {% if contentType %}
        {% include '@EMSCore/app/menu.html.twig' with {
            'item':  'data-index-' ~ contentType.id
        } %}
    {% endif %}

    <script src="{{ asset('bundles/emscore/bower/ace-builds/src-min-noconflict/ace.js') }}"></script>

    <script type="text/javascript">
        $(window).ready(function () {
            $(".ems-code-editor").each(function () {
                var editor = ace.edit(this);
                if ($(this).data('theme')) {
                    editor.setTheme($(this).data('theme'));
                }
                if ($(this).data('language')) {
                    editor.session.setMode($(this).data('language'));
                }
                var maxLines = 500;
                if ($(this).data('max-lines') && $(this).data('max-lines') > 0) {
                    maxLines = $(this).data('max-lines');
                }
                editor.setOptions({
                    readOnly: true,
                    highlightActiveLine: false,
                    highlightGutterLine: false,
                    maxLines: maxLines
                });
                editor.renderer.$cursorLayer.element.style.opacity = 0;
                editor.textInput.getElement().tabIndex = -1;
                editor.commands.commmandKeyBinding = {};
            });
        });
    </script>
{% endblock %}	