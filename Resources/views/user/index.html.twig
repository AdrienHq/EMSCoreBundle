{% extends 'EMSCoreBundle::base.html.twig' %}
{% trans_default_domain 'EMSCoreBundle' %}

{% block title %}{{ 'Users list'|trans }}{% endblock %}
{% block pagetitle %}{{ 'Users list'|trans }}{% endblock %} 
{% block subtitle %}<small>{{ 'Are they ready to rock?'|trans }}</small>
{% endblock %} {% block body %}

<div class="row">
	<div class="col-md-12">
		<div class="box ">
			<div class="box-header with-border">
				<i class="fa fa-users"></i>
				<h3 class="box-title">{{ 'Users'|trans }}</h3>
				{% if add_user_route %}
					<a class="btn btn-xs btn-primary pull-right"
						href="{{ path(add_user_route) }}"><i class="fa fa-plus"></i>
						{{ 'Add user'|trans }}</a>
				{%endif%}
			</div>
			<!-- /.box-header -->
			<div class="box-body">
				<div class="table-responsive">
				<table class="table table-condensed table-striped">
					<tbody>
						<tr>
							<th class="text-center" style="width: 10px">{{ '#'|trans }}</th>
							<th>{{ 'Username'|trans }}</th>
							<th>{{ 'Display name'|trans }}</th>
							<th>{{ 'email'|trans }}</th>
							<th>{{ 'Circles'|trans }}</th>
							<th>{{ 'Enabled'|trans }}</th>
							<th>{{ 'Roles'|trans }}</th>
							<th>{{ 'Last login'|trans }}</th>
							<th>{{ 'Action'|trans }}</th>
						</tr>
						{% for user in users %}
							<tr>
								<td class="text-center" style="width: 10px">{{ loop.index }}</td>
								<td>{{ user.username }}</td>
								<td>{{ user.displayName }}</td>
								<td>{{ user.email }}</td>
								<td>
									{% for circle in user.circles %}
										{{ circle|data_link|raw }}
									{% endfor %}
								</td>
								<td>
									{% if user.enabled is not defined or user.enabled  %}
										<i class="fa fa-check"></i>
									{% endif %}
								</td>
								<td>
									{% for role in user.roles %}
										{% if not loop.first %}
											{% if loop.last %}
											&amp;
											{% else %}
											,
											{% endif %}
										{% endif %}
										{{ role|trans }}
									{% endfor %}
								</td>
								<td>{{ user.lastLogin|date(date_time_format) }}</td>
								<td>
									<div class="btn-group">
										{% include 'EMSCoreBundle:elements:get-button.html.twig' with {
											'url':  path('user.edit', {'id': user.id}),
											'label': 'Edit',
											'icon': 'pencil'
										}%}
										{% if user.enabled %}
											{% if not is_granted('ROLE_PREVIOUS_ADMIN') %}
												{% include 'EMSCoreBundle:elements:get-button.html.twig' with {
													'url':  path('homepage', {'_switch_user': user.username}),
													'label': 'Switch user',
													'icon': 'user-secret'
												}%}
											{% endif %}
											{% if not is_granted('ROLE_PREVIOUS_ADMIN') %}
												{% include 'EMSCoreBundle:elements:post-button.html.twig' with {
													'url': path('user.enabling', {'id': user.id}),
														'message': 'Disable the user ' ~ user.username ~ ' ?',
														'label': 'Disable',
														'icon': 'user-times'
												}%}
											{% endif %}
										{% else %}
											{% include 'EMSCoreBundle:elements:post-button.html.twig' with {
													'url': path('user.enabling', {'id': user.id}),
													'message': 'Enable the user ' ~ user.username ~ ' ?',
													'label': 'Enable',
													'icon': 'user-plus'
											}%}
										{% endif %}
										{% include 'EMSCoreBundle:elements:post-button.html.twig' with {
												'url': path('EMS_user_apikey', {'username': user.username}),
												'message': 'Generate API key for ' ~ user.username ~ ' ?',
												'label': 'API key',
												'icon': 'key'
										}%}
										{% include 'EMSCoreBundle:elements:post-button.html.twig' with {
											'url': path('user.delete', {'id': user.id}),
											'message': 'Delete the user ' ~ user.username ~ ' ?',
											'label': 'Delete',
											'icon': 'trash'
										}%}
				                    </div>
								</td>
							</tr>						
						{% endfor %}
					</tbody>
				</table>
				</div>
			</div>
			<!-- /.box-body -->
		</div>
	</div>
</div>
{% endblock %} 


{% block javascripts %}
	{% include 'EMSCoreBundle:app:menu.html.twig' with {
		'item':  'user-index'
	}%}
{% endblock %}